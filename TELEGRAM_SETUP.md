# راهنمای اتصال ربات تلگرام به صندوق بلال حبشی

## مرحله ۱: ساخت ربات در تلگرام

1. در تلگرام به **@BotFather** بروید.
2. دستور `/newbot` را بفرستید.
3. یک **نام** برای ربات وارد کنید (مثلاً: صندوق قرض‌الحسنه بلال حبشی).
4. یک **username** برای ربات وارد کنید که حتماً به `bot` ختم شود (مثلاً: `sanduq_bilal_bot`).
5. BotFather یک **توکن (Token)** به شما می‌دهد. شکل آن شبیه این است:
   ```
   7123456789:AAHxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
   ```
6. این توکن را **کپی** کنید و جایی امن نگه دارید؛ با آن می‌توان به ربات دستور داد.

---

## مرحله ۲: قرار دادن توکن در برنامه

1. در پوشهٔ **backend** فایل **`.env`** را باز کنید.
2. یک خط جدید اضافه کنید:
   ```env
   TELEGRAM_BOT_TOKEN=7123456789:AAHxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
   ```
   (به‌جای توکن بالا، توکن واقعی که از BotFather گرفتید را بگذارید.)
3. فایل را ذخیره کنید و سرور را یک بار **ریستارت** کنید.

---

## مرحله ۳: تست ربات

1. در تلگرام ربات خود را **جستجو** کنید (با همان username که دادید).
2. روی **Start** یا **شروع** بزنید.
3. دستور `/start` را بفرستید.
4. اگر همه‌چیز درست باشد، ربات با یک پیام خوش‌آمد پاسخ می‌دهد.

---

## نحوهٔ کار در این پروژه

- سرور (فایل `server.js`) هنگام بالا آمدن، اگر مقدار `TELEGRAM_BOT_TOKEN` در `.env` باشد، **ربات را فعال می‌کند**.
- ربات با روش **Long Polling** به تلگرام وصل می‌شود؛ یعنی نیازی به آدرس عمومی (دامنه یا ngrok) نیست و روی همین کامپیوتر و شبکهٔ محلی هم کار می‌کند.
- در حال حاضر ربات فقط به `/start` پاسخ می‌دهد. می‌توانید بعداً دستورهای دیگر (مثلاً وضعیت صندوق، اعلان واریز، و غیره) را به همین فایل `telegramBot.js` اضافه کنید.

---

## استفاده از پروکسی (در صورت فیلتر بودن تلگرام)

اگر به خاطر فیلتر به سرور تلگرام وصل نمی‌شوید، می‌توانید از پروکسی استفاده کنید (مطابق پروژهٔ v3):

1. در فایل **`.env`** این دو خط را اضافه یا از حالت کامنت خارج کنید:
   ```env
   USE_PROXY=true
   TELEGRAM_PROXY_URL=http://127.0.0.1:10809
   ```
2. **`TELEGRAM_PROXY_URL`** را با آدرس واقعی پروکسی خود عوض کنید (مثلاً آدرس و پورت VPN یا پروکسی محلی).
3. سرور را ریستارت کنید. در لاگ باید ببینید: «ربات تلگرام با پروکسی فعال شد».
4. دکمهٔ **«بررسی ارتباط»** در منوی تلگرام پنل ادمین هم از همین پروکسی استفاده می‌کند.

---

## نکات امنیتی

- **توکن را در گیت قرار ندهید.** فایل `.env` معمولاً در `.gitignore` است؛ آن را commit نکنید.
- توکن را فقط در سرور یا محیطی که خودتان کنترل می‌کنید نگه دارید.

---

## اگر ربات جواب نداد

- مطمئن شوید سرور را **بعد از اضافه کردن توکن** دوباره اجرا کرده‌اید.
- در لاگ سرور باید خطی شبیه «ربات تلگرام فعال شد» را ببینید.
- اگر هنوز جواب نمی‌دهد، توکن را دوباره از BotFather با دستور `/token` بگیرید و در `.env` اصلاح کنید.
